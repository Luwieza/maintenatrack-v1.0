{% extends "base.html" %}
{% block content %}
<h1 class="page-title">Maintenance Logs</h1>

<form method="get" class="filters card" style="gap:12px">
  <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
    <input class="input" type="text" name="q" value="{{ q }}" placeholder="üîç Search all logs (alarm, description, steps, equipment, user)..." style="min-width: 300px; flex: 1;" />
    <input class="input" type="number" name="zone" min="1" max="22" value="{{ zone }}" placeholder="Zone (1‚Äì22)" style="width:120px" />
    <select name="difficulty" class="input" style="width:170px">
      <option value="">Any difficulty</option>
      <option value="Easy"   {% if difficulty == "Easy" %}selected{% endif %}>Easy</option>
      <option value="Medium" {% if difficulty == "Medium" %}selected{% endif %}>Medium</option>
      <option value="Hard"   {% if difficulty == "Hard" %}selected{% endif %}>Hard</option>
    </select>
    {% if user.is_authenticated %}
    <select name="my_logs" class="input" style="width:140px">
      <option value="">üåê All users</option>
      <option value="true" {% if my_logs == "true" %}selected{% endif %}>üë§ My logs only</option>
    </select>
    {% endif %}
    <button class="btn btn-primary" type="submit">üîç Search</button>
  </div>
  {% if q or zone or difficulty or my_logs %}
  <div style="margin-top: 8px; font-size: 14px; color: var(--ink-2);">
    <strong>Searching:</strong>
    {% if not my_logs %}All users' logs{% else %}Your logs only{% endif %}
    {% if q %} ‚Ä¢ Keyword: "{{ q }}"{% endif %}
    {% if zone %} ‚Ä¢ Zone: {{ zone }}{% endif %}
    {% if difficulty %} ‚Ä¢ Difficulty: {{ difficulty }}{% endif %}
    <a href="{% url 'maintenance:log_list' %}" style="margin-left: 10px; color: var(--jj-red);">Clear all filters</a>
  </div>
  {% endif %}
</form>

{% if q or zone or difficulty or my_logs %}
<div style="margin: 20px 0; padding: 10px; background: var(--bg-soft); border-radius: 8px;">
  <strong>{{ page_obj.paginator.count }}</strong> log{{ page_obj.paginator.count|pluralize }} found
  {% if q %}matching "{{ q }}"{% endif %}
  {% if not my_logs %} from <strong>all users</strong>{% else %} from <strong>your logs</strong>{% endif %}
</div>
{% endif %}

<ul class="list">
  {% for log in logs %}
    <li class="card">
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between">
        <div>
          <div style="font-weight:700">
            <a href="{% url 'maintenance:log_detail' log.pk %}">
              [Zone {{ log.zone }}] {{ log.alarm_code }} ‚Äî {{ log.alarm_name|default:"(unnamed)" }}
            </a>
          </div>
          <div class="chip" style="margin-top:6px">{{ log.difficulty }}</div>
          {% if log.lam_checked %}<span class="chip" style="margin-left:6px">LAM checked</span>{% endif %}
          {% if log.equipment %}
            <div style="margin-top:6px;color:var(--ink-2)">Equipment: {{ log.equipment.name }} ({{ log.equipment.asset_tag }})</div>
          {% endif %}
        </div>
        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
          <div style="text-align:right;color:var(--ink-2);font-size:13px">
            {{ log.created_at|date:"Y-m-d H:i" }}<br>
            by {{ log.created_by|default:"‚Äî" }}
          </div>
          {% if user.is_authenticated and log.created_by == user %}
          <div style="display: flex; gap: 6px;">
            <a href="{% url 'maintenance:log_update' log.pk %}" class="btn btn-success" style="font-size: 12px; padding: 4px 8px;">
              Edit
            </a>
            <a href="{% url 'maintenance:log_delete' log.pk %}" class="btn btn-danger" style="font-size: 12px; padding: 4px 8px;">
              Delete
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </li>
  {% empty %}
    <li class="empty">
      <strong>No logs found.</strong>
      <div style="margin-top:6px">Be the first to document a fix‚Äîcapture a new maintenance log.</div>
      <div style="margin-top:10px">
        <a class="btn btn-primary" href="{% url 'maintenance:log_create' %}">New Log</a>
      </div>
    </li>
  {% endfor %}
</ul>
{% endblock %}
