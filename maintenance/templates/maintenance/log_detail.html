{% extends "base.html" %} {% block content %}
<div
  style="
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 16px;
  "
>
  <h1 class="page-title" style="margin: 0">
    [Zone {{ log.zone }}] {{ log.alarm_code }} — {{
    log.alarm_name|default:"(unnamed)" }}
  </h1>

  {% if user.is_authenticated and log.created_by == user %}
  <div style="display: flex; gap: 8px">
    <a
      href="{% url 'maintenance:log_update' log.pk %}"
      class="btn btn-success"
      style="font-size: 14px"
    >
      📝 Edit Log
    </a>
    <a
      href="{% url 'maintenance:log_delete' log.pk %}"
      class="btn btn-danger"
      style="font-size: 14px"
    >
      🗑️ Delete Log
    </a>
  </div>
  {% endif %}
</div>

<div class="card" style="margin-bottom: 14px">
  <div style="display: flex; gap: 10px; flex-wrap: wrap">
    <span class="chip">{{ log.difficulty }}</span>
    <span class="chip">LAM: {{ log.lam_checked|yesno:"Yes,No" }}</span>
    {% if log.equipment %}
    <span class="chip">Equipment: {{ log.equipment.name }}</span>
    {% endif %}
    <span class="chip">Created: {{ log.created_at|date:"Y-m-d H:i" }}</span>
    {% if log.created_by %}
    <span class="chip">By: {{ log.created_by }}</span>
    {% endif %}
  </div>
</div>

<div class="card">
  <h3 style="margin: 0 0 8px 0">Problem & Summary</h3>
  <p style="margin: 0; white-space: pre-line">{{ log.description }}</p>
</div>

<div class="card" style="margin-top: 14px">
  <h3 style="margin: 0 0 8px 0">Steps</h3>
  <ol class="stepset" style="padding-left: 20px; margin: 0">
    {% for step in log.steps.all %}
    <li class="step">
      <div style="font-weight: 700; margin-bottom: 6px">
        Step {{ step.order }}
      </div>
      <div>
        <strong>Action:</strong>
        <span style="white-space: pre-line">{{ step.action }}</span>
      </div>
      {% if step.result %}
      <div style="margin-top: 6px">
        <strong>Result:</strong>
        <span style="white-space: pre-line">{{ step.result }}</span>
      </div>
      {% endif %}
      <div
        style="
          display: flex;
          gap: 10px;
          margin-top: 8px;
          color: var(--ink-2);
          font-size: 13px;
        "
      >
        {% if step.duration_minutes %}
        <span class="chip">{{ step.duration_minutes }} min</span>
        {% endif %} {% if step.performed_by %}
        <span class="chip">By {{ step.performed_by }}</span>
        {% endif %}
      </div>
    </li>
    {% empty %}
    <li class="empty">No steps captured.</li>
    {% endfor %}
  </ol>
</div>
{% endblock %}
